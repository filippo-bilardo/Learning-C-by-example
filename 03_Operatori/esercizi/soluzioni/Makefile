# Makefile per Soluzioni Esercizi - Lezione 03: Operatori
# Compilazione automatica con testing e validazione

# Configurazione compilatore
CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g
SRCDIR = .
BINDIR = ../../../bin/03_operatori_soluzioni

# Lista delle soluzioni
SOLUTIONS = esercizio1_soluzione esercizio2_soluzione esercizio3_soluzione
SOURCES = $(SOLUTIONS:=.c)
BINARIES = $(addprefix $(BINDIR)/, $(SOLUTIONS))

# Colori per output
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[1;33m
BLUE = \033[0;34m
PURPLE = \033[0;35m
CYAN = \033[0;36m
WHITE = \033[1;37m
NC = \033[0m # No Color

# Target principale
.PHONY: all clean test run-all help validate demo

all: setup $(BINARIES)
	@echo "$(GREEN)âœ… Tutte le soluzioni compilate con successo!$(NC)"
	@echo "$(CYAN)ğŸ“‚ Binari disponibili in: $(BINDIR)$(NC)"
	@echo "$(YELLOW)ğŸ’¡ Usa 'make run-all' per testare tutte le soluzioni$(NC)"

# Setup directory
setup:
	@mkdir -p $(BINDIR)

# Compilazione individuale
$(BINDIR)/%: %.c
	@echo "$(BLUE)ğŸ”¨ Compilazione: $< â†’ $@$(NC)"
	@$(CC) $(CFLAGS) $< -o $@ -lm
	@echo "$(GREEN)âœ… $@ compilato$(NC)"

# Target per eseguire tutte le soluzioni
run-all: all
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘              ğŸ§ª TEST AUTOMATICO SOLUZIONI ğŸ§ª             â•‘$(NC)"
	@echo "$(PURPLE)â•‘                   Lezione 03: Operatori                  â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@$(MAKE) run-1
	@echo "\n$(CYAN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)\n"
	@$(MAKE) run-2
	@echo "\n$(CYAN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)\n"
	@$(MAKE) run-3

# Esecuzione singole soluzioni con input automatico
run-1: $(BINDIR)/esercizio1_soluzione
	@echo "$(YELLOW)ğŸ§® ESERCIZIO 1: Calcolatore Espressioni$(NC)"
	@echo "$(WHITE)Input automatico: 10 5 3$(NC)"
	@echo "10\n5\n3" | $(BINDIR)/esercizio1_soluzione

run-2: $(BINDIR)/esercizio2_soluzione
	@echo "$(YELLOW)ğŸ” ESERCIZIO 2: Sistema Controllo Accessi$(NC)"
	@echo "$(WHITE)Input automatico: ID=1250, Livello=4, EtÃ =28, Badge=s, Orario=s, Auth=n$(NC)"
	@echo "1250\n4\n28\ns\ns\nn" | $(BINDIR)/esercizio2_soluzione

run-3: $(BINDIR)/esercizio3_soluzione
	@echo "$(YELLOW)ğŸ¨ ESERCIZIO 3: Manipolatore Pixel RGB$(NC)"
	@echo "$(WHITE)Input automatico: R=255, G=87, B=51 (arancione)$(NC)"
	@echo "255\n87\n51" | $(BINDIR)/esercizio3_soluzione

# Demo interattiva
demo: all
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘                    ğŸ® DEMO INTERATTIVA ğŸ®                â•‘$(NC)"
	@echo "$(PURPLE)â•‘                   Scegli una soluzione                   â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(CYAN)1)$(NC) $(YELLOW)ğŸ§® Calcolatore Espressioni$(NC) (operatori aritmetici)"
	@echo "$(CYAN)2)$(NC) $(YELLOW)ğŸ” Sistema Controllo Accessi$(NC) (operatori logici)"
	@echo "$(CYAN)3)$(NC) $(YELLOW)ğŸ¨ Manipolatore Pixel RGB$(NC) (operatori bit a bit)"
	@echo ""
	@read -p "$(WHITE)Inserisci il numero (1-3): $(NC)" choice; \
	case $$choice in \
		1) echo "$(GREEN)Avvio Esercizio 1...$(NC)"; $(BINDIR)/esercizio1_soluzione ;; \
		2) echo "$(GREEN)Avvio Esercizio 2...$(NC)"; $(BINDIR)/esercizio2_soluzione ;; \
		3) echo "$(GREEN)Avvio Esercizio 3...$(NC)"; $(BINDIR)/esercizio3_soluzione ;; \
		*) echo "$(RED)âŒ Scelta non valida!$(NC)" ;; \
	esac

# Validazione codice
validate: all
	@echo "$(BLUE)ğŸ” VALIDAZIONE CODICE SOLUZIONI$(NC)"
	@echo "$(CYAN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	
	@echo "$(YELLOW)ğŸ“Š Statistiche codice:$(NC)"
	@for sol in $(SOLUTIONS); do \
		lines=$$(wc -l < $$sol.c); \
		echo "   $$sol.c: $$lines righe"; \
	done
	
	@echo "\n$(YELLOW)ğŸ”§ Controllo sintassi:$(NC)"
	@for sol in $(SOLUTIONS); do \
		if $(CC) $(CFLAGS) -fsyntax-only $$sol.c 2>/dev/null; then \
			echo "   $(GREEN)âœ… $$sol.c: Sintassi corretta$(NC)"; \
		else \
			echo "   $(RED)âŒ $$sol.c: Errori di sintassi$(NC)"; \
		fi; \
	done
	
	@echo "\n$(YELLOW)ğŸ“ Controllo stile:$(NC)"
	@for sol in $(SOLUTIONS); do \
		if command -v clang-format >/dev/null 2>&1; then \
			if clang-format --dry-run $$sol.c 2>/dev/null | diff $$sol.c - >/dev/null; then \
				echo "   $(GREEN)âœ… $$sol.c: Stile conforme$(NC)"; \
			else \
				echo "   $(YELLOW)âš ï¸  $$sol.c: Stile migliorabile$(NC)"; \
			fi; \
		else \
			echo "   $(CYAN)â„¹ï¸  clang-format non disponibile per check stile$(NC)"; \
			break; \
		fi; \
	done

# Test specifici per concetti
test: all
	@echo "$(PURPLE)ğŸ§ª TEST CONCETTI SPECIFICI$(NC)"
	@echo "$(CYAN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	
	@echo "$(YELLOW)ğŸ”¸ Test Operatori Aritmetici:$(NC)"
	@echo "12\n4\n2" | $(BINDIR)/esercizio1_soluzione | grep -q "ACCESSO GARANTITO" || echo "   Test precedenza: OK"
	
	@echo "$(YELLOW)ğŸ”¸ Test Operatori Logici:$(NC)"
	@echo "1000\n5\n30\ns\ns\ns" | $(BINDIR)/esercizio2_soluzione | grep -q "5/5" && echo "   Test accesso completo: OK"
	
	@echo "$(YELLOW)ğŸ”¸ Test Operatori Bit:$(NC)"
	@echo "255\n0\n0" | $(BINDIR)/esercizio3_soluzione | grep -q "FF0000" && echo "   Test manipolazione bit: OK"

# Benchmark performance
benchmark: all
	@echo "$(PURPLE)âš¡ BENCHMARK PERFORMANCE$(NC)"
	@echo "$(CYAN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	
	@for sol in $(SOLUTIONS); do \
		echo "$(YELLOW)ğŸ“Š Benchmark $(BINDIR)/$$sol:$(NC)"; \
		time_output=$$(time -f "%e secondi" echo "10\n5\n3" | $(BINDIR)/$$sol >/dev/null 2>&1); \
		echo "   Tempo esecuzione: $$time_output"; \
	done 2>/dev/null || echo "$(CYAN)â„¹ï¸  GNU time non disponibile per benchmark precisi$(NC)"

# Target per il debug
debug: CFLAGS += -DDEBUG -O0
debug: all
	@echo "$(RED)ğŸ› Versioni DEBUG compilate$(NC)"
	@echo "$(YELLOW)ğŸ’¡ Usa gdb per debugging: gdb $(BINDIR)/esercizio1_soluzione$(NC)"

# Target per la release
release: CFLAGS += -O3 -DNDEBUG
release: all
	@echo "$(GREEN)ğŸš€ Versioni RELEASE ottimizzate compilate$(NC)"

# Pulizia
clean:
	@echo "$(YELLOW)ğŸ§¹ Pulizia files...$(NC)"
	@rm -rf $(BINDIR)
	@echo "$(GREEN)âœ… Pulizia completata$(NC)"

# Aiuto
help:
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘                   ğŸ“– MAKEFILE HELP ğŸ“–                   â•‘$(NC)"
	@echo "$(PURPLE)â•‘                Soluzioni Lezione 03                     â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(CYAN)ğŸ¯ TARGET PRINCIPALI:$(NC)"
	@echo "  $(YELLOW)make all$(NC)        - Compila tutte le soluzioni"
	@echo "  $(YELLOW)make run-all$(NC)    - Esegue test automatici di tutte"
	@echo "  $(YELLOW)make demo$(NC)       - Demo interattiva (scegli esercizio)"
	@echo "  $(YELLOW)make clean$(NC)      - Rimuove tutti i binari"
	@echo ""
	@echo "$(CYAN)ğŸ”§ TARGET SVILUPPO:$(NC)"
	@echo "  $(YELLOW)make debug$(NC)      - Compila con simboli debug"
	@echo "  $(YELLOW)make release$(NC)    - Compila ottimizzato per produzione"
	@echo "  $(YELLOW)make validate$(NC)   - Valida sintassi e stile codice"
	@echo "  $(YELLOW)make test$(NC)       - Test funzionalitÃ  specifiche"
	@echo "  $(YELLOW)make benchmark$(NC)  - Misura performance esecuzione"
	@echo ""
	@echo "$(CYAN)ğŸ® TARGET INDIVIDUALI:$(NC)"
	@echo "  $(YELLOW)make run-1$(NC)      - Solo Calcolatore Espressioni"
	@echo "  $(YELLOW)make run-2$(NC)      - Solo Sistema Controllo Accessi"
	@echo "  $(YELLOW)make run-3$(NC)      - Solo Manipolatore Pixel RGB"
	@echo ""
	@echo "$(CYAN)ğŸ“ STRUTTURA OUTPUT:$(NC)"
	@echo "  $(WHITE)$(BINDIR)/$(NC)"
	@echo "  â”œâ”€â”€ esercizio1_soluzione (operatori aritmetici)"
	@echo "  â”œâ”€â”€ esercizio2_soluzione (operatori logici)"
	@echo "  â””â”€â”€ esercizio3_soluzione (operatori bit a bit)"

# File da non considerare come target
.PHONY: setup run-1 run-2 run-3 debug release benchmark

# Info progetto
info:
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘                  ğŸ“Š INFO PROGETTO ğŸ“Š                    â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(CYAN)ğŸ“š Corso:$(NC) C by Example - Lezione 03: Operatori"
	@echo "$(CYAN)ğŸ¯ Focus:$(NC) Padronanza completa degli operatori C"
	@echo "$(CYAN)ğŸ“ˆ Livello:$(NC) Da principiante a avanzato"
	@echo "$(CYAN)â±ï¸  Tempo:$(NC) 30-90 minuti per esercizio"
	@echo ""
	@echo "$(YELLOW)ğŸ”¹ Esercizio 1:$(NC) Operatori aritmetici e precedenza"
	@echo "$(YELLOW)ğŸ”¹ Esercizio 2:$(NC) Operatori logici e relazionali"
	@echo "$(YELLOW)ğŸ”¹ Esercizio 3:$(NC) Operatori bit a bit avanzati"
	@echo ""
	@echo "$(GREEN)âœ¨ Features:$(NC)"
	@echo "  â€¢ Gestione errori completa"
	@echo "  â€¢ Output colorato e interattivo"
	@echo "  â€¢ Spiegazioni dettagliate"
	@echo "  â€¢ Esempi pratici real-world"
	@echo "  â€¢ Testing automatico"
